# [Task]: T-Phase5-Oracle
# [From]: specs/001-todo-crud/plan.md - Phase V Cloud Deployment
# NGINX Ingress for Oracle OKE
# Prerequisites: Install NGINX Ingress Controller:
#   helm repo add ingress-nginx https://kubernetes.github.io/ingress-nginx
#   helm install ingress-nginx ingress-nginx/ingress-nginx -n todo-app \
#     --set controller.service.annotations."oci\.oraclecloud\.com/load-balancer-type"="lb" \
#     --set controller.service.annotations."service\.beta\.kubernetes\.io/oci-load-balancer-shape"="flexible" \
#     --set controller.service.annotations."service\.beta\.kubernetes\.io/oci-load-balancer-shape-flex-min"="10" \
#     --set controller.service.annotations."service\.beta\.kubernetes\.io/oci-load-balancer-shape-flex-max"="10"
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: todo-app-ingress
  namespace: todo-app
  labels:
    app: evolution-of-todo
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
    nginx.ingress.kubernetes.io/proxy-body-size: "10m"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "60"
    nginx.ingress.kubernetes.io/proxy-send-timeout: "60"
    # CORS for frontend-backend communication
    nginx.ingress.kubernetes.io/enable-cors: "true"
    nginx.ingress.kubernetes.io/cors-allow-origin: "*"
    nginx.ingress.kubernetes.io/cors-allow-methods: "GET, POST, PUT, DELETE, PATCH, OPTIONS"
    nginx.ingress.kubernetes.io/cors-allow-headers: "Authorization, Content-Type"
spec:
  ingressClassName: nginx
  rules:
    # Chatbot Frontend (main entry point)
    - http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: todo-release-chatbot-frontend
                port:
                  number: 3000
          # Chatbot Backend API
          - path: /api
            pathType: Prefix
            backend:
              service:
                name: todo-release-chatbot-backend
                port:
                  number: 8000
          # Phase II Backend API (if enabled)
          - path: /api/v2
            pathType: Prefix
            backend:
              service:
                name: todo-release-backend
                port:
                  number: 8000
